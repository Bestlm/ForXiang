<wxs module="util" src="../util.wxs" />

<view class="container white" style="animation-name: animation-blur; animation-duration: 0.8s; background-color: white !important;">
  <image src="../../images/Mission.gif" mode='widthFix' />
  <view class="form-group" 
  style="z-index: 0; box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.05), 0 6px 20px 0 rgba(0, 0, 0, 0.05); ">
    <view class="form-cell">
      <view class="mission-info_title">ğŸ“Œ ä»»åŠ¡åç§°</view>
      <view class="mission-info_desc">{{mission.title}}</view>
    </view>
    <view class="form-cell">
      <view class="mission-info_title">ğŸ’¡ æ‰§è¡Œè®¡åˆ’</view>
      <view class="mission-info_desc">æ­¤ä»»åŠ¡ç”±{{from}}å‘å¸ƒï¼Œç”±{{to}}å®Œæˆæ‰§è¡Œï¼Œå®Œæˆå{{to}}å°†è·å¾—ç§¯åˆ†ã€‚</view>
    </view>
    <view class="form-cell" wx:if="{{!mission.isLongTerm}}">
      <view class="mission-info_title">ğŸ’° å¥–åŠ±åŠ›åº¦ï¼š{{mission.credit}} ç§¯åˆ†</view>
      <progress percent="{{creditPercent}}" border-radius="5" font-size="8" duration="10" color="lightsalmon" active stroke-width="7"> 
        <view class="mission-info_credit">{{maxCredit}} ç§¯åˆ†</view>
      </progress>
    </view>
    <view class="form-cell" wx:if="{{mission.isLongTerm}}">
      <view class="mission-info_title">ğŸ”„ é•¿æœŸä»»åŠ¡è¿›åº¦</view>
      <view class="longterm-info">
        <view class="progress-section">
          <progress percent="{{mission.completedDays / mission.totalDays * 100}}" stroke-width="8" activeColor="#ff5794" backgroundColor="#f0f0f0" />
          <view class="progress-text">{{mission.completedDays}}/{{mission.totalDays}} å¤©</view>
        </view>
        <view class="daily-credit">æ¯æ—¥ç§¯åˆ†ï¼š{{mission.dailyCredit}} åˆ†</view>
        <view class="total-credit">æ€»ç§¯åˆ†ï¼š{{mission.credit}} åˆ†</view>
      </view>
    </view>
    <!-- æ˜¾ç¤ºæ‰“å¡/å®Œæˆè®°å½•ï¼Œæ— è®ºæ˜¯é•¿æœŸä»»åŠ¡è¿˜æ˜¯æ™®é€šä»»åŠ¡ -->
    <view class="form-cell" wx:if="{{mission.isLongTerm || mission.checkinRecords}}">
      <view class="mission-info_title">ğŸ“” {{mission.isLongTerm ? 'æ‰“å¡è®°å½•' : 'å®Œæˆè®°å½•'}}</view>
      <view class="daily-records">
        <!-- é•¿æœŸä»»åŠ¡æ˜¾ç¤ºdailyRecords -->
        <view class="record-item" wx:for="{{mission.isLongTerm ? mission.dailyRecords : mission.checkinRecords}}" wx:key="index">
          <view class="record-content">
            <view class="record-date">{{item.formattedDate || item.date}}</view>
            <view class="record-status {{item.status}}">
              <text wx:if="{{item.status === 'pending'}}">â³ å¾…å®¡æ ¸</text>
              <text wx:elif="{{item.status === 'approved'}}">âœ“ å·²é€šè¿‡</text>
              <text wx:else>âœ— å·²é©³å›</text>
            </view>
          </view>
          <!-- åªæœ‰ä»»åŠ¡å‘å¸ƒè€…æ‰èƒ½çœ‹åˆ°å®¡æ ¸æŒ‰é’®ï¼Œå¹¶ä¸”è®°å½•çŠ¶æ€ä¸ºå¾…å®¡æ ¸ -->
          <view class="audit-buttons" wx:if="{{currentOpenId === mission._openid && item.status === 'pending'}}">
            <button class="approve-btn" bindtap="approveCheckin" data-index="{{index}}">é€šè¿‡</button>
            <button class="reject-btn" bindtap="rejectCheckin" data-index="{{index}}">é©³å›</button>
          </view>
        </view>
        <view class="record-empty" wx:if="{{(mission.isLongTerm ? mission.dailyRecords.length : (mission.checkinRecords ? mission.checkinRecords.length : 0)) === 0}}">
          æš‚æ— {{mission.isLongTerm ? 'æ‰“å¡' : 'å®Œæˆ'}}è®°å½•
        </view>
      </view>
    </view>
    <view class="form-cell">
      <view class="mission-info_title">ğŸ“… åˆ›å»ºæ—¥æœŸ</view>
      <view class="mission-info_desc">{{dateStr}}</view>
    </view>
    <view class="form-cell">
      <view class="mission-info_title">ğŸ“ ä»»åŠ¡è¯¦æƒ…</view>
      <view class="mission-info_desc">{{mission.desc}}</view>
    </view>
  </view>
</view>